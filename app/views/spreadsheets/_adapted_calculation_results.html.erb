  <%= tag.p do %>
    <%= content_tag :table, class: 'list' do %>
      <%= content_tag :head do %>
        <%= content_tag :tr do %>
          <%= content_tag(:th, l(:label_calculation), class: 'name') %>
          <% @columns.each do |column| %>
            <%= content_tag(:th, column.name, class: 'name') %>
          <% end %>
        <% end %>
      <% end %>
      <%= content_tag :tbody do %>
        <% @calculations.each do |calc| %> 
          <% data = DataMatrix.new(@row_ids, calc.column_ids) %>
          <%= content_tag :tr do %>
            <%= content_tag(:td, calc.name, class: 'name') %>
            <% @columns.each do |column| %>
                <% if calc.field_ids.include? column.id %>
                  <% value = Formula.new(calc.formula, data.values_of_column(column.id)).exec %>
                  <%= content_tag(:td, value, class: 'name') %>
                <% else %>
                  <%= content_tag(:td, '-', class: 'name') %>
                <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>